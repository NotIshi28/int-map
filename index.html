<html><head>
    <title>Interactive Global Population Visualization with Framed Flags</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #globe {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
            display: none;
        }
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        #population-display {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 18px;
        }
        #flag-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        #flag-frame {
            width: 160px;
            height: 100px;
            border: 5px solid #4B5358;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #2B3034;
        }
        #flag-frame img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
    </head>
    <body>
    <div id="globe"></div>
    <div id="tooltip"></div>
    <div id="instructions">
        Use arrow keys to rotate the globe:<br>
        ← → : Rotate horizontally<br>
        ↑ ↓ : Rotate vertically<br>
        Click on a country to highlight it<br>
        Hover over a country to see its flag
    </div>
    <div id="population-display"></div>
    <div id="flag-display">
        <div id="flag-frame">
            <img id="flag-img" src="" alt="Country flag">
        </div>
    </div>
    <script>
        const width = window.innerWidth;
        const height = window.innerHeight;
        const sensitivity = 75;
    
        const projection = d3.geoOrthographic()
            .scale(Math.min(width, height) / 2.5)
            .center([0, 0])
            .rotate([0, -30])
            .translate([width / 2, height / 2]);
    
        const canvas = d3.select('#globe')
            .append('canvas')
            .attr('width', width)
            .attr('height', height);
    
        const context = canvas.node().getContext('2d');
        const path = d3.geoPath()
        .projection(projection)
        .context(context);

    const tooltip = d3.select('#tooltip');
    const populationDisplay = d3.select('#population-display');
    const flagDisplay = d3.select('#flag-display');
    const flagImg = d3.select('#flag-img');

    // Comprehensive population data (2021 estimates)
    const populationData = {
        "China": 1439323776,
        "India": 1380004385,
        "United States": 331002651,
        "Indonesia": 273523615,
        "Pakistan": 220892340,
        "Brazil": 212559417,
        "Nigeria": 206139589,
        "Bangladesh": 164689383,
        "Russia": 145934462,
        "Mexico": 128932753,
        "Japan": 126476461,
        "Philippines": 109581078,
        "Egypt": 102334404,
        "Ethiopia": 114963588,
        "Vietnam": 97338579,
        "DR Congo": 89561403,
        "Turkey": 84339067,
        "Iran": 83992949,
        "Germany": 83783942,
        "Thailand": 69799978,
        "United Kingdom": 67886011,
        "France": 65273511,
        "Italy": 60461826,
        "South Africa": 59308690,
        "Tanzania": 59734218,
        "Myanmar": 54409800,
        "Kenya": 53771296,
        "South Korea": 51269185,
        "Colombia": 50882891,
        "Spain": 46754778,
        "Argentina": 45195774,
        "Algeria": 43851044,
        "Sudan": 43849260,
        "Ukraine": 43733762,
        "Uganda": 45741007,
        "Iraq": 40222493,
        "Poland": 37846611,
        "Canada": 37742154,
        "Morocco": 36910560,
        "Saudi Arabia": 34813871,
        "Uzbekistan": 33469203,
        "Peru": 32971854,
        "Angola": 32866272,
        "Malaysia": 32365999,
        "Mozambique": 31255435,
        "Ghana": 31072940,
        "Yemen": 29825964,
        "Nepal": 29136808,
        "Venezuela": 28435940,
        "Madagascar": 27691018,
        "Cameroon": 26545863,
        "Côte d'Ivoire": 26378274,
        "North Korea": 25778816,
        "Australia": 25499884,
        "Niger": 24206644,
        "Taiwan": 23816775,
        "Sri Lanka": 21413249,
        "Burkina Faso": 20903273,
        "Mali": 20250833,
        "Romania": 19237691,
        "Malawi": 19129952,
        "Chile": 19116201,
        "Kazakhstan": 18776707,
        "Zambia": 18383955,
        "Guatemala": 17915568,
        "Ecuador": 17643054,
        "Syria": 17500658,
        "Netherlands": 17134872,
        "Senegal": 16743927,
        "Cambodia": 16718965,
        "Chad": 16425864,
        "Somalia": 15893222,
        "Zimbabwe": 14862924,
        "Guinea": 13132795,
        "Rwanda": 12952218,
        "Benin": 12123200,
        "Burundi": 11890784,
        "Tunisia": 11818619,
        "Bolivia": 11673021,
        "Belgium": 11589623,
        "Haiti": 11402528,
        "Cuba": 11326616,
        "South Sudan": 11193725,
        "Dominican Republic": 10847910,
        "Czech Republic (Czechia)": 10708981,
        "Greece": 10423054,
        "Jordan": 10203134,
        "Portugal": 10196709,
        "Azerbaijan": 10139177,
        "Sweden": 10099265,
        "Honduras": 9904607,
        "United Arab Emirates": 9890402,
        "Hungary": 9660351,
    }
    </script>
    </body>
    </html>